<!DOCTYPE html>
<html lang="en-GB">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>CryS - Cryptocurrency Smart Manager</title>
    <link rel="stylesheet" href="scholarly.css">
    <link rel="stylesheet" href="https://vivliostyle.github.io/vivliostyle_doc/samples/scholarly/node_modules/prismjs/themes/prism-coy.css">
    <script src="https://vivliostyle.github.io/vivliostyle_doc/samples/scholarly/node_modules/prismjs/prism.js" defer></script>
</head>

<body prefix="schema: http://schema.org/ xsd: http://www.w3.org/2001/XMLSchema# sa: https://ns.science.ai/">
    <article id="what" typeof="schema:ScholarlyArticle" resource="#">
        <header>
            <h1 property="schema:name">CryS</h1>
            <p role="doc-subtitle" property="schema:alternateName">
                Cryptocurrency Smart Manager
            </p>
        </header>
        <div role="contentinfo">
            <section typeof="sa:AuthorsList">
                <h2>Authors</h2>
                <ul>
                    <li typeof="sa:ContributorRole" property="schema:contributor">
                        <span typeof="schema:Person" resource="https://www.linkedin.com/in/silviu-cristian-lupu-627464121/">
                    <meta property="schema:givenName" content="Silviu">
                    <meta property="schema:additionalName" content="Cristian">
                    <meta property="schema:familyName" content="Lupu">
                    <span property="schema:name">Silviu-Cristian Lupu</span>
                        </span>
                        <ul>
                            <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                                <a href="mailto:lupu.silviu.cristian@info.uaic.ro" property="schema:email">lupu.silviu.cristian@info.uaic.ro</a>
                            </li>
                        </ul>
                    </li>
                    <li typeof="sa:ContributorRole" property="schema:contributor">
                        <span typeof="schema:Person" resource="https://www.linkedin.com/in/mihaela-r-19bb72144/">
                      <meta property="schema:givenName" content="Mihaela">
                      <meta property="schema:additionalName" content="Florentina">
                      <meta property="schema:familyName" content="Rapa">
                      <span property="schema:name">Mihaela Florentina Rapa</span>
                        </span>
                        <ul>
                            <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                                <a href="mailto:mihaela.rapa@info.uaic.ro" property="schema:email">mihaela.rapa@info.uaic.ro</a>
                            </li>
                        </ul>
                    </li>
                    <li typeof="sa:ContributorRole" property="schema:contributor">
                        <span typeof="schema:Person" resource="https://www.linkedin.com/in/lucian-toma-2566a1144/">
                      <meta property="schema:givenName" content="Lucian">
                      <meta property="schema:familyName" content="Toma">
                      <span property="schema:name">Lucian Toma</span>
                        </span>
                        <ul>
                            <li property="schema:roleContactPoint" typeof="schema:ContactPoint">
                                <a href="mailto:lucian.toma@info.uaic.ro" property="schema:email">lucian.toma@info.uaic.ro</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </section>
        </div>

        <section typeof="sa:Abstract" id="abstract">
            <h2>Abstract</h2>
            <p>
                A cryptocurrency is a digital or virtual currency that is secured by cryptography, which makes it nearly impossible to counterfeit or double-spend. Many cryptocurrencies are decentralized networks based on blockchain technologyâ€”a distributed ledger enforced by a disparate network of computers. A defining feature of cryptocurrencies is that they are generally not issued by any central authority, rendering them theoretically immune to government interference or manipulation.
            </p>
            <p>
                Following the exponential increase in price of the first cryptocurrency, Bitcoin, from $2 USD in December 2011 to almost $20 000 USD in December 2017, over 6000 altcoins (alternative variants of cryptocurrency other than Bitcoin) were created. Many people regret having traded hundreds of Bitcoin for a pizza, and even more got rich from mining Bitcoins and other altcoins, leading to hyperinflated prices in computer parts (GPUs and CPUs) used in mining rigs.
            </p>
            <p>
                It seems that cryptocurrencies are here to stay, and as it is the case with any other domain, being informed is very important. CryS aims to provide a one-stop shop about anything related to altcoins: news, recent transactions, market trends, price history, price forecast and details about what makes each altcoin unique.
            </p>
        </section>
        <section typeof="sa:MaterialsAndMethods" id="features">
            <h2>Proposed solution</h2>
            <p>CryS will incorporate the following main functionalities:</p>
            <ul>
                <li>aggregated news feed about most popular cryptocurrencies</li>
                <li>transaction feed on most popular blockchains</li>
                <li>cryptocurrency ranking based on market cap and available supply</li>
                <li>details of interest about cryptocurrency, such as available supply, price, trading symbol, recent price trends and blockchain particularities</li>
                <li>links to other resources of interest about cryptocurrencies, such as message boards, tehnical docs, blockchain explorers and even source code</li>
                <li>machine learning prediction of future prices, as well as historical price data</li>
            </ul>
            <p>On top of providing useful functionality to end users, CryS will align itself to the latest software engineering best practices and approaches by incorporating the following principles:</p>
            <ul>
                <li>modular architecture based on microservices</li>
                <li>serverless approach</li>
                <li>performance and scalability</li>
                <li>well documented, developer friendly API</li>
                <li>publicly exposing the underlying open linked data in multiple formats</li>
            </ul>
        </section>
        <section typeof="sa:MaterialsAndMethods" id="architecture">
            <h2>Architecture</h2>
            <figure typeof="sa:Image">
                <img src="images/general_architecture.svg" width="880" height="655">
                <figcaption>The general architecture of CryS TODO: New architecture with new module, graphDB and fuseki, + prediction daemon</figcaption>
            </figure>
            <p>
                As mentioned previously, CryS will have a modular architecture based on microservices while also following the serverless paradigm. Given these considerations, we have opted to use Amazon Lambda as the backbone of CryS: multiple lambda functions can be grouped together to create a microservice, new functionality can be added to a microservice by adding a new lambda function, and new microservices can be spun up just as easily thanks to the great integration between Lambda and API Gateway.
            </p>
            <p>Next, we dive deeper into each microservice:</p>
            <ul>
                <li>
                    <p>
                        <code>News microservice:</code> responsible with sourcing the news articles about cryptocurrencies and mapping them to existing entities in the system
                    </p>
                </li>
                <li>
                    <p>
                        <code>Transactions microservice:</code> provides access to transaction info of various cryptocurrencies
                    </p>
                </li>
                <li>
                    <p>
                        <code>Numismatics microservice:</code> the most complex of the microservices, it handles almost everything related to cryptocurrencies, except future price predictions
                    </p>
                </li>
                <li>
                    <p>
                        <code>Price history microservice:</code> provides historical prices for cryptocurrencies.
                    </p>
                </li>
                <li>
                    <p>
                        <code>Predictions microservice:</code> uses machine learning to predict the future price of a certain cryptocurrency.
                    </p>
                </li>
            </ul>
            <p>
                In addition to the suite of microservices described above, which are exclusively used by our front-end application, we have implemented mirrored functionalities that return data in diffrent RDF notations:
            </p>
            <ul>
                <li>
                    <p>
                        <code>Turtle</code>
                    </p>
                </li>
                <li>
                    <p>
                        <code>N-Triples</code>
                    </p>
                </li>
                <li>
                    <p>
                        <code>JSON-LD</code>
                    </p>
                </li>
                <li>
                    <p>
                        <code>RDF/XML</code>
                    </p>
                </li>
            </ul>
            <p>API data in the above formats can be accessed via the same URLs as the data used in the front-end application, only prefixed by <code>/rdf</code>. More on this in the Implemntation details section.</p>
        </section>
        <section typeof="sa:MaterialsAndMethods" id="design">
            <h2>Software design</h2>
            <figure typeof="sa:Image">
                <img src="images/sequence_diagram.svg" width="880" height="655">
                <figcaption>Diagram describing the sequence of events for rendering the home page of CryS</figcaption>
            </figure>
            <figure typeof="sa:Image">
                <img src="images/use_case_diagram.svg" width="880" height="655">
                <figcaption>Diagram describing all actions a user can take when using CryS</figcaption>
            </figure>
        </section>
        <section typeof="sa:MaterialsAndMethods" id="data_modelling_sourcing">
            <h2>Data sourcing and data modeling</h2>
            <h3>Data sourcing</h3>
            <p>
                In order to provide the users with accurate and up to date information, CryS leverages multiple APIs:
            </p>
            <ul>
                <li>
                    <p><code><a href="https://cryptopanic.com/developers/api/">Cryptopanic API</a></code>: offers programmatic access to a suite of cryptocurrency-related news gathered from multiple sources.</p>
                </li>
                <li>
                    <p><code><a href="https://github.com/blockchain/api-v1-client-python">Blockchain API</a></code>: offers programmatic access to transactions on the Bitcoin blockchain</p>
                </li>
                <li>
                    <p><code><a href="https://pro.coinmarketcap.com/migrate/">Coinmarketcap API</a></code>: provides detailed information about individual cryptocoins, such as price, market cap, volume, circulating supply etc.</p>
                </li>
                <li>
                    <p><code><a href="https://min-api.cryptocompare.com/">CryptoCompare API</a></code>: provides historical data about cryptocurrencies trading prices</p>
                </li>
            </ul>
            <p>
                <b>Note:</b> while we understand the importance of reusing and linking existing data rather than creating our own, we found that existing data on cryptocurrencies from <code><a href="https://wiki.dbpedia.org/">DBPedia</a></code> and <code><a href="https://www.wikidata.org/">WikiData</a></code> is sparse and would bring little value to the end user. We instead chose to provide the cryptocurrency's technical doc (where applicable) via <code>rdfs:seeAlso</code>.
            </p>
            <h3>Data modelling</h3>
            <figure typeof="sa:Image">
                <img src="images/data_modeling_diagram.svg">
                <figcaption>The initial CryS data model</figcaption>
            </figure>
            <p>
                Above we have the inital data model for CryS. Since then, we have added a new class, <code>PriceHistory</code>, that models the historical price data for a coin, and have extended the list of attributes each class has.
            </p>
            <figure typeof="sa:Image">
                <img src="images/class_hierarchy.png">
                <figcaption>CryS class hierarchy diagram</figcaption>
            </figure>
            <p>
                The following diagrams show the data properties, but also the relationships between classes. TODO: Add rdfs:seeAlso to ttl.
            </p>
            <figure typeof="sa:Image">
                <img src="images/coin_drd.png">
                <figcaption>Domain-range graph for Coin</figcaption>
            </figure>
            <figure typeof="sa:Image">
                <img src="images/news_drd.png">
                <figcaption>Domain-range graph for News</figcaption>
            </figure>
            <figure typeof="sa:Image">
                <img src="images/pricehistory_drd.png">
                <figcaption>Domain-range graph for PriceHistory</figcaption>
            </figure>
            <figure typeof="sa:Image">
                <img src="images/prediction_drd.png">
                <figcaption>Domain-range graph for Prediction</figcaption>
            </figure>
            <figure typeof="sa:Image">
                <img src="images/transaction_drd.png">
                <figcaption>Domain-range graph for Transaction</figcaption>
            </figure>

            <figure typeof="sa:Image">
                <img src="images/class_relationship.png">
                <figcaption>CryS class relationship diagram</figcaption>
            </figure>
            <figure typeof="sa:Image">
                <img src="images/class_links_diagram.png">
                <figcaption>CryS class links diagram</figcaption>
            </figure>
            <figure typeof="sa:Image">
                <img src="images/USDT_visual_graph.png">
                <figcaption>The visual graph of the Tether (USDT) cryptocurrency</figcaption>
            </figure>
        </section>
        <section typeof="sa:MaterialsAndMethods" id="implementation_details">
            <h2>Implementation details</h2>
            <h3>Database</h3>
            <p>
                For storing the linked data, we actually use two different triple stores: <code>GraphDB</code> and <code>Apache Jena Fuseki</code> (along side the officially vended library for queries), each bringing unique functionalities to the table.
            </p>
            <p>
                On one hand, GraphDB provides many visual representations for the linked data (e.g. visaul graph for a resource, domain-range diagram etc.), which we used throughout the development process to discover interesting connections between coins.sSome of these graphs are showcased in the Data Modelling section. As a client for sending queries to GraphDB, we have used <code>SPARQLWrapper</code>, a lightweight SPARQL Python library, having the advantage of integrating well in our all-Python back-end ecosystem. The downsight of using GraphDB and SPARQLWrapper is that we could only produce JSON output; while this was easy to ingest by our front-end application, it failed on satisfying the need of producing output in different RDF notations.
            </p>
            <p>
                On the other hand, Apache Jena Fuseki does not offer nealry as many "fancy" data visualizations. But, it offers out-of-the box conversion to multiple RDF notations. However, the downsight of using Jena is that it's only available in Java, and getting Java and Lambda to play along nicely is tricky:
            </p>
            <figure typeof="schema:SoftwareSourceCode">
                <pre>
                <code>
public void handleRequest(InputStream inputStream, OutputStream outputStream, Context context) throws IOException {
            // call these or really weird stuff happens
            org.apache.jena.query.ARQ.init();
            org.apache.jena.riot.RIOT.init();
                </code>
              </pre>
            </figure>
            <h3>API</h3>
            <p>
                As we initially planned, the CryS API (both the back-end of our front-end application and the endpoints offering data in different RDF notations) were implemented using AWS Lambda and AWS API Gateway. Next, we dive deeper into what it takes to add functionality to one of CryS's microservices and making it available in the CryS API.
            </p>
            <p>
                The following code implements the functionality of retrieving a coin by id:
            </p>
            <figure typeof="schema:SoftwareSourceCode">
                <pre>
              <code>
import json
from SPARQLWrapper import SPARQLWrapper, JSON

def lambda_handler(event, context):
  sparql = SPARQLWrapper(
      "http://ec2-3-120-140-142.eu-central-1.compute.amazonaws.com:7200//repositories/crys")
  query_base = """
PREFIX crys: <http://example.com/crys#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
SELECT * WHERE {{
  ?coin rdf:type crys:Coin ;
        crys:id "{id}"^^xsd:nonNegativeInteger ;
        crys:cmc_rank ?cmc_rank ;
        crys:name ?name ;
        crys:synopsis ?description ;
        crys:symbol ?symbol ;
        crys:circulating_supply ?circulating_supply ;
        crys:date_added ?date_added ;
        crys:logo ?logo ;
        crys:market_cap ?market_cap ;
        crys:percent_change_24h ?percent_change_24h ;
        crys:percent_change_7d ?percent_change_7d ;
        crys:price ?price ;
        crys:status ?status ;
        crys:mineable ?mineable ;
  optional {{?coin  crys:announcement ?announcement}} .
  optional {{?coin  crys:chat ?chat }} .
  optional {{?coin  crys:explorer ?explorer }} .
  optional {{?coin  crys:message_board ?message_board }} .
  optional {{?coin  crys:reddit ?reddit }} .
  optional {{?coin  crys:source_code ?source_code }} .
  optional {{?coin  crys:technical_doc ?technical_doc }} .
  optional {{?coin  crys:twitter ?twitter }} .
  optional {{?coin  crys:website ?website }} .
  optional {{?coin  crys:platform ?platform }} .
}}
"""

  path_params = event["pathParameters"]

  id = path_params['id']
  query = query_base.format(id=id)

  sparql.setQuery(query)
  sparql.setReturnFormat(JSON)
  results = sparql.query().convert()

  if len(results['results']['bindings']):
      return {
          'statusCode': 200,
          'headers': {"Access-Control-Allow-Origin": "*"},
          'body': json.dumps(results)
      }
  return {
      'statusCode': 404,
      'headers': {"Access-Control-Allow-Origin": "*"},
      'body': 'No coin with specified id'
  }
              </code>
            </pre>
                <figcaption>Lambda function handler for retrieving a coin by id</figcaption>
            </figure>
            <p>
                We define the Lambda function GetCoin, and using the API Gateway interface, we map the GET method at the <code>/coins/{id}</code> path on our API.
            </p>
            <figure typeof="sa:Image">
                <img src="images/get_coin_lambda.png">
                <figcaption>Mapping of an HTTP method on an API resource to a Lambda Function</figcaption>
            </figure>
            <p>
                As a result, API gatway will proxy any HTTP GET requests on the <code>/coins/{id}</code> path to the GetCoin Lambda function, which will construct the sparql query by including the id of the coin we want to retrieve. The result will either be all the information on the coin with the specified id, or an HTTP 404 response if no coin with that ID exists.
            </p>
            <p>
                All the information exposed by the CryS REST API is also available in multiple RDF notations, thanks to the use of Apache Jena. The RDF data is available on the same API, nested in the <code>/rdf</code> prefix.
            </p>
            <p>For example, if one would be interested in the latest news on Ethereum, and need the results as N-Triples...</p>
            <figure typeof="sa:Image">
                <img src="images/news_ntriples.png">
                <figcaption>Response returned by https://4cgsg07w3e.execute-api.eu-central-1.amazonaws.com/beta/rdf/news?symbol=ETH&limit=2&format=N-Triples</figcaption>
            </figure>

            <p>Or maybe someone would be interested in the projected price of Bitcoin for the next three days in Turtle...</p>

            <figure typeof="sa:Image">
                <img src="images/predictions_turtle.png">
                <figcaption>Response returned by https://4cgsg07w3e.execute-api.eu-central-1.amazonaws.com/beta/rdf/predictions?symbol=BTC&period=3</figcaption>
            </figure>
            <h3>Predictions</h3>
            <p>
                One of the most important features we wanted CryS to offer were price predictions for all crytpocurrencies CryS manages. In this section, we take a look on how CryS achieves to predict crytpocurrency prices and how these predictions are fed into the linked data.
            </p>
            <p>
                CryS uses a separate subsystem for generating the predictions. This system runs daily and produces a price forecast for the next 7 days. Each time it runs, the predictions subsystem fetches historical price data aggregated per day, runs the prediction algorithm which produces 7 float values, representing the maximum predicted price for the upcoming 7 days, then constructs a Prediction object and inserts it in both triple stores utilized by CryS.
            </p>
            <p>
                As of the prediction algorithm, we used the <code>AutoRegressive Integrated Moving Average Model</code> - <code>ARIMA</code>, a popular and widely used model for time series forecasting. The ARIMA model is readily available in the time series analysis and time prediction Python library, <code>PyFlux</code>, so all we had to do is a little bit of time series and dataframe magic.
            </p>
            <p>
                To test the ARIMA model's accuracy, we obtained 2000 datapoints of historical price data. From these, we cut 7 apart to keep as validation. Then, we used the first 1993 values as training data for the ARIMA model, and predicted the value of the next 7 datapoints, which we compared with the datpoints we set aside. We used <code>Mean Absolute Percentage Error</code> - <code>MAPE</code> as the performance metric:
            </p>
            <figure typeof="sa:Image">
              <img src="images/mape.svg">
              <figcaption>Formula for MAPE; A<sub>t</sub> is the actual value and F<sub>t</sub> is the forecasted value</figcaption>
            </figure>
            <p>The results we obtained were interesting. For some of the more popular coins, such as Bitcoin or Ethereum, the ARIMA model works great, with a MAPE value of ~ 6%. On some of the more exotic cryptocurrencies, especially those valued at less than a dolar, the MAPE value soars towards the hundreds or thousands mark, so definitely take the predictions offered by CryS with a pinch of salt.</p>
            <p>As a closing thought, it is worth noting that no person involved in the development of CryS has ever done anything remotely close to timeseries prediction. Instead of refining the predictions, we chose to stick to the task at hand and focus on the semantic side of CryS.</p>
        </section>
        <section typeof="sa:MaterialsAndMethods" id="user_guide">
            <h2>Use cases and user guide</h2>
            <p>
                Use cases go here
            </p>
            <h3>User Interface</h3>
            <figure typeof="sa:Image">
                <img src="images/crys_home_page.png">
                <figcaption>Landing page of CryS</figcaption>
            </figure>
            <p>
                This is the first page CryS users come in contact with. On the left side of the page, recent news about cryptocurrencies are displayed; this a great way for users to catch up with what's been happening in the world of cryptocoins. On the right side of the page, we can see a feed of the latest transactions on popular blockchains; this gives the user insight into the dynamics of the market.
            </p>
            <figure typeof="sa:Image">
                <img src="images/crys_numismatics_page.png">
                <figcaption>Numismatics - CryS's coin catalog</figcaption>
            </figure>
            <p>
                The Numismatics page displays the collection of cryptocurrencies CryS has information on. A search option will be available, as well as the ability to sort the cryptocurrencies by various fields, such as price, market cap or 24h fluctuation. Clicking on an entry will take the user to that coin's details page.
            </p>
            <figure typeof="sa:Image">
                <img src="images/crys_coin_details_page.png">
                <figcaption>Coin details page - get to know the coin</figcaption>
            </figure>
            <p>
                The coin details page provides a brief description, as well as useful links to news about that coin specifically (if any). The main focus on this page is the graph illustrating the price prediction for that coin.
            </p>
        </section>
        <section typeof="sa:ReferenceList" id="references">
            <h2>References</h2>
            <ol>
                <li><a href="https://doacc.github.io/">DOACC</a></li>
                <li><a href="https://cryptopanic.com/">CrytpoPanic</a></li>
                <li><a href="https://coinmarketcap.com/">CoinMarketCap</a></li>
            </ol>
        </section>
    </article>
</body>

</html>